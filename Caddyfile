:80

# Proxy para API - encaminha requisições /api/* para o backend
handle /api/* {
    reverse_proxy localhost:3000
}

# Proxy para health check do backend
handle /health {
    reverse_proxy localhost:3000
}

# Frontend - servir arquivos estáticos e SPA routing
handle {
    root * /app/dist
    
    # Servir arquivos estáticos
    file_server
    
    # SPA routing - fallback para index.html
    try_files {path} /index.html
}

# Headers de segurança
header {
    X-Frame-Options "SAMEORIGIN"
    X-Content-Type-Options "nosniff"
    X-XSS-Protection "1; mode=block"
}

# Gzip compression
encode gzip

# Cache para arquivos estáticos
@static {
    path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
}
header @static Cache-Control "public, max-age=31536000, immutable"

